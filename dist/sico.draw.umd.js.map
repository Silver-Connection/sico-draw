{"version":3,"file":"sico.draw.umd.js","sources":["../src/main.ts","../src/gauge/lib.ts"],"sourcesContent":["import { IGaugeConfig, IGaugeData, LabelFunction } from \"./gauge/interface\";\nimport { Gauge } from \"./gauge/lib\";\n\nexport { IGaugeConfig, IGaugeData, LabelFunction } from \"./gauge/interface\";\nexport default {\n    Gauge: Gauge\n};","import { IGaugeConfig, IGaugeData } from \"./interface\";\n\ndeclare var G_vmlCanvasManager: any;\n\nexport class Gauge {\n    public static degToRands(value?: number): number {\n        if (value === undefined) {\n            return Math.PI / 180;\n        }\n        return value * Math.PI / 180;\n    }\n\n    public static percentToRands(value?: number, max?: number): number {\n        if (value === undefined || max === undefined) {\n            return Math.PI / 180;\n        }\n        return value * max / 100 * Math.PI / 180;\n    }\n\n    public options!: IGaugeConfig;\n    public el!: HTMLElement;\n    public elLabels!: JQuery<HTMLElement>;\n    public canvas!: HTMLCanvasElement;\n    public context!: CanvasRenderingContext2D;\n\n    protected default: IGaugeConfig =\n        {\n            autoDraw: true,\n            backgroundColor: \"#E3DBCB\",\n            backgroundShow: true,\n            canvasHeight: 300,\n            canvasWidth: 600,\n            centerX: \"center\",\n            centerY: \"center\",\n            data: undefined,\n            deg: 180,\n            lineCap: \"butt\",\n            labelInverse: false,\n            labelHtml: false,\n            labelHtmlUseCanvasSize: false,\n            labelCssBase: undefined,\n            offset: 180,\n        };\n\n    protected defaultData: IGaugeData =\n        {\n            color: \"#0382A0\",\n            label: undefined,\n            labelCss: undefined,\n            labelColor: \"#727272\",\n            labelFont: \"sans-serif\",\n            labelShow: true,\n            labelSize: 20,\n            labelStyle: \"normal normal bold\",\n            size: 10,\n            value: 0,\n        };\n\n    private centerXFactor: number = 0.5;\n    private centerYFactor: number = 0.5;\n    private gaugeSize: number = 0;\n    private labelSize: number = 0;\n\n    constructor(element: HTMLElement | JQuery<HTMLElement>, opt: IGaugeConfig) {\n        // Wrapper\n        if (element === null || element === undefined) {\n            // tslint:disable-next-line:no-console\n            console.log(\"Could not find wrapper element\");\n            return;\n        }\n\n        if (element instanceof HTMLElement) {\n            this.el = element;\n        } else {\n            this.el = element[0];\n        }\n\n        // Configs\n        this.options = $.extend(true, this.default, opt);\n        this.checkData();\n        let flexX = \"center\";\n        if (this.options.centerX === \"left\") {\n            this.centerXFactor = 0;\n            flexX = \"flex-start\";\n        } else if (this.options.centerX === \"right\") {\n            this.centerXFactor = 1;\n            flexX = \"flex-end\";\n        } else {\n            this.centerXFactor = 0.5;\n        }\n\n        let flexY = \"center\";\n        if (this.options.centerY === \"top\") {\n            this.centerYFactor = 0;\n            flexY = \"flex-start\";\n        } else if (this.options.centerY === \"bottom\") {\n            this.centerYFactor = 1;\n            flexY = \"flex-end\";\n        } else {\n            this.centerYFactor = 0.5;\n        }\n\n        // HTML Labels\n        if (this.options.labelHtml) {\n\n            this.elLabels = $(\"<div></div)\");\n            this.elLabels.css({\n                \"position\": \"absolute\",\n                \"top\": 0,\n                \"left\": 0,\n                \"height\": this.options.labelHtmlUseCanvasSize ? this.options.canvasHeight : \"100%\",\n                \"width\": this.options.labelHtmlUseCanvasSize ? this.options.canvasWidth : \"100%\",\n                \"display\": \"flex\",\n                \"flex-direction\": \"column\",\n                \"justify-content\": flexY,\n                \"align-items\": flexX,\n            });\n\n            $(this.el).css({\n                \"position\": \"relative\",\n            }).append(this.elLabels);\n        }\n\n        // Create and draw Canvas\n        this.createCanvas();\n        if (this.options.autoDraw) {\n            this.$draw();\n        }\n    }\n\n    public createCanvas() {\n        this.canvas = document.createElement(\"canvas\");\n        this.el.appendChild(this.canvas);\n\n        if (typeof (G_vmlCanvasManager) === \"object\") {\n            G_vmlCanvasManager.initElement(this.canvas);\n        }\n\n        this.canvas.height = this.options.canvasHeight;\n        this.canvas.width = this.options.canvasWidth;\n        const c = this.canvas.getContext(\"2d\");\n        if (c !== null) {\n            this.context = c;\n        }\n\n        let scaleBy = 1;\n        if (window.devicePixelRatio > 1) {\n            scaleBy = window.devicePixelRatio;\n            this.canvas.width = this.canvas.width * scaleBy;\n            this.canvas.height = this.canvas.height * scaleBy;\n            this.context.scale(scaleBy, scaleBy);\n        }\n\n        // Clear\n        // this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    public $draw() {\n        // Draw background\n        if (this.options.backgroundShow) {\n            this.drawBackground();\n        }\n\n        // Draw data lines\n        if (this.options != undefined\n            && this.options.data != undefined\n            && this.options.data.length > 0) {\n            let offsetLine = 0;\n            let offsetText = this.options.labelHtml ? 0 : 1;\n            for (const data of this.options.data) {\n                this.drawGauge(data, offsetLine);\n                offsetLine += data.size!;\n            }\n\n            const ll = this.options.labelInverse ? this.options.data.reverse() : this.options.data;\n            for (const data of ll) {\n                if (data.labelShow) {\n                    if (!this.options.labelHtml) {\n                        this.drawText(data, offsetText);\n                        offsetText += (data.labelSize || 0) + 10;\n                    } else {\n                        this.htmlText(data);\n                    }\n                }\n            }\n        }\n    }\n\n    public drawBackground() {\n        const rands = Gauge.degToRands(this.options.deg);\n        this.drawLine(rands, this.gaugeSize, this.options.backgroundColor!, 0);\n    }\n\n    public drawGauge(data: IGaugeData, offset: number = 0) {\n        const rands = Gauge.percentToRands(data.value, this.options.deg);\n        this.drawLine(rands, data.size!, data.color!, offset);\n    }\n\n    public drawLine(rands: number, size: number, color: string, offset: number = 0) {\n        // Arc\n        const center = this.getCenterPoint();\n        let radius = (this.canvas.width / 2) - (size / 2) - offset;\n        if (this.canvas.width < this.canvas.height) {\n            radius = (this.canvas.height / 2) - (size / 2) - offset;\n        }\n\n        this.context.beginPath();\n        this.context.arc(center.x, center.y, radius, Gauge.degToRands(this.options.offset), rands + Gauge.degToRands(this.options.offset), false);\n        this.context.strokeStyle = color;\n        this.context.lineWidth = size;\n        this.context.lineCap = this.options.lineCap!;\n        this.context.stroke();\n        this.context.closePath();\n    }\n\n    public drawText(data: IGaugeData, offset: number) {\n        const center = this.getCenterPoint();\n        const font = (data.labelStyle + \" \" + data.labelSize + \"px \" + data.labelFont).trim();\n\n        let label = \"\";\n        if (typeof data.label === \"function\") {\n            label = data.label(data.value);\n        } else {\n            label = data.label || \"\";\n        }\n\n        this.context.textAlign = this.options.centerX || this.default.centerX!;\n        this.context.font = font;\n\n        let y = center.y - offset;\n        if (this.options.centerY === \"center\") {\n            y = center.y - offset + this.labelSize / 2;\n        } else if (this.options.centerY === \"top\") {\n            y = offset + this.labelSize / 2;\n        }\n\n        this.context.fillStyle = data.labelColor!;\n        this.context.fillText(label, center.x, y);\n    }\n\n    public htmlText(data: IGaugeData) {\n        let label = \"\";\n        if (typeof data.label === \"function\") {\n            label = data.label(data.value);\n        } else {\n            label = data.label || \"\";\n        }\n\n        let css = this.options.labelCssBase!;\n        if (data.labelCss) {\n            css += \" \" + data.labelCss;\n        }\n\n        this.elLabels.append('<span class=\"' + css + '\">' + label + \"</span>\");\n    }\n\n    private getCenterPoint() {\n        return {\n            x: this.canvas.width * this.centerXFactor,\n            y: this.canvas.height * this.centerYFactor,\n        };\n    }\n\n    private checkData() {\n        if (this.options != undefined && this.options.data != undefined && this.options.data.length > 0) {\n            for (let i = 0; i < this.options.data.length; i++) {\n                this.options.data[i] = $.extend(true, {}, this.defaultData, this.options.data[i]);\n                if (this.options.data[i].label === undefined) {\n                    this.options.data[i].label = this.options.data[i].value + \"%\";\n                }\n\n                // Total size\n                this.gaugeSize += this.options.data[i].size!;\n                this.labelSize += this.options.data[i].labelSize!;\n            }\n        }\n    }\n}"],"names":["Gauge","element","opt","this","autoDraw","backgroundColor","backgroundShow","canvasHeight","canvasWidth","centerX","centerY","data","undefined","deg","lineCap","labelInverse","labelHtml","labelHtmlUseCanvasSize","labelCssBase","offset","color","label","labelCss","labelColor","labelFont","labelShow","labelSize","labelStyle","size","value","HTMLElement","el","options","$","extend","default","checkData","flexX","centerXFactor","flexY","centerYFactor","elLabels","css","position","top","left","height","width","display","flex-direction","justify-content","align-items","append","createCanvas","$draw","console","log","Math","PI","max","canvas","document","createElement","appendChild","G_vmlCanvasManager","initElement","c","getContext","context","scaleBy","window","devicePixelRatio","scale","drawBackground","length","offsetLine","offsetText","_a","_i","drawGauge","ll_1","reverse","_b","htmlText","drawText","rands","degToRands","drawLine","gaugeSize","percentToRands","center","getCenterPoint","radius","beginPath","arc","x","y","strokeStyle","lineWidth","stroke","closePath","font","trim","textAlign","fillStyle","fillText","i","defaultData"],"mappings":"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"}